(ns sudoku.solve-test
  (:require [clojure.test :refer [deftest is]]
            [sudoku.read :as read]
            [sudoku.solve :as solve]))

(def test-puzzles
  ["4  58   2   2     1     69   69   5  8     4  3   82   53     1     9   8   72  5"
   " 3 9  2689    4      1     8    179           698    4     5      3    6275  8 4 "
   "9    7   4 8  9   6258     2   3 4    4   1    6 7   3     3985   5  6 4   9    2"
   "1     24   6   7  9 4 25    6 35 9             9 67 3    68 3 9  2   5   37     1"
   "    3   81  5     3     75   7  6 29 6  9  3 89 7  6   72     4     9  59   2    "
   " 2    4 1   9   8     1532   9  8   5   2   8   3  7   8769     1   3   9 3    1 "
   "2 5 9  1 6  2 8   9  4            98 9  1  4 85            5  7   3 2  1 3  6 5 2"
   " 5   28  4     72    3   5  2 5634             3247 1  7   1    46     8  17   9 "
   "9 2 8      46   9  1      41   4  7 7  8 3  1 6  9   32      6  3   42      2 7 8"
   "1  7 6           8 634  1   2 5    75 1   6 28    2 3   2  597 4           9 7  1"
   " 4 81      8  6  19  3   8  1  4 2    6   1    2 5  3  7   8  35  2  6      74 5 "
   " 4   7  58 65  3 2      1     9 2 6   7   9   9 6 8     1      2 8  56 97  1   3 "
   "  2  7 6     9  426     5    1 6   55  8 9  18   2 7    7     491  4     4 6  8  "
   "85    1   3178      6  9      6   9 6   1   7 4   3      3  8      9264   8    39"
   "  2   47 3        8 9 57      7 1 8 4   3   9 2 4 9      62 8 3        6 38   9  "
   "    5   2  6    1   73 6   9   3 78 8  6 7  9 73 8   4   8 19   3    4  6   4    "
   "9 6  2        92     37  6 2   6   7 4 2 7 1 6   9   5 8  31     57        9  1 3"
   " 8  1 7    26    8 3 7    4   4    7 1  6  9 9    3   4    8 3 5    62    6 5  4 "
   " 64     1    2     3 7 4  8 9 8 21 5         7 59 6 3 4  5 7 1     6    2     68 "
   " 6  9      4 1  56  16          2  9825   1437  1          84  67  3 9      5  2 "
   "  1    3     6819 4    9 8   5  2 4    5 1    3 7  8   1 8    9 9315     4    3  "
   "     8   8 3 2  4   1  3  5 7  5 2    48 25    8 1  9 1  5  9   5  4 7 8   2     "
   "        7 83  6  9 2  91 4     284             467     6 15  7 5  2  31 7        "
   "  9   12  8   5     5 9 8 4  23 1 6           4 5 92  4 3 6 5     9   7  61   3  "
   "        54   6  1      3 826397   2    8 9    8   675979 4      2  5   13        "
   " 9     5    9 1     5  8 979  2    161     785    4  246 3  7     6 9    3     2 "
   "      2  8 19 7    7  5  6   82   76    4    71   39   9  8  3    4 91 8  4      "
   "   8   25     6  4   52 7  4 57    1  9   6  1    83 2  1 83   7  2     84   1   "
   "5  738      9  3  3  5  9 11     6    6   7    9     46 7  3  9  5  2      671  8"
   "   6  39   2 3  7  64   1 5   79    5       3    61   4 8   26  1  8 7   95  6   "
   "4 573  2 93 4 1             96 2   4         8   6 15             6 4 13 7  198 6"
   "      6 3 3   2 1  1   798 8 7  9     3   8     2  7 1 548   3  8 5   6 2 6      "
   "    5 2   69  2  34  6   8   6 7     9  1  4     2 1   2   4  75  2  43   3 8    "
   " 1     463  4          259 1   47    8  9  3    36   5 376          4  162     8 "
   "87 1        5  68     2   7 8   92    7 1 3    63   4 4   5     39  7        1 35"
   "3  2  94 8         1 43  8   518                 265   2  74 5         8 69  1  7"
   "        4 2     3  4137  89   9    7   248   9    6   48  1735  5     6 7        "
   " 8        5 18 39 9 6    8    7 35 1         7 56 4    6    4 9 14 78 3        5 "
   "48  2  7  5      6  1  63     86    6 5   9 8    45     43  7  7      4  2  1  95"
   "     6   2     5191   9    3 8  7    2 9 1 3    4  9 5    7   4463     8   2     "
   "2 3   49  9   37   6   8     48 9     2   8     1 72     4   6   13   7  26   1 3"
   " 1     759    738     2    84 6    7   9 4   5    8 19    6     851    243     6 "
   " 983  6  6 2  5 8   48     5  7       9   7       9  5     25   8 9  3 1  1  796 "
   "        79 54     13     29    24  87   9   55  61    36     81     59 48        "
   "   716 5 3         6 3  2    6  8 7 2   6   3 8 4  6    3  5 1         8 5 627   "
   "  4  63   2     57 1   8       12  5 8  4  7 7  83       5   6 17     2   61  9  "
   "   43  9       68 5 7     2  6  8 3    361    3 9  8  6     1 7 75       2  45   "
   "4   7  6 5    12   92   1 4     9 3 7       2 6 5     6 4   81   74    3 8  1   6"
   "     1 63 62   84  5        9 12     3  6  5     47 3        9  49   78 61 3     "
   "   9358 7  1     9   7 16    7    61         34    9    64 9   5     4  7 4263   "
   "    41   7  9      6 7  2 55 8    9 9  8 3  6 7    4 28 5  4 3      5  1   69    "
   "82  49   1     2 8 9          1 34   1  2  3   86 5          2 3 5     4   57  81"
   "     2   4 1  87   9     35 7  8 349         384 1  7 73     1   54  9 7   1     "
   " 25 17 6    5       6 3   18     3 51       92 3     74   6 1       5    7 24 98 "
   " 1   7 9      5  297      3    3487     5     9471    8      461  2      3 8   5 "
   " 45   8    13    6    6  1   89 5   2       5   2 86   9  4    3    24    2   13 "
   "     26  39    5    2 3     219    7 7  2  8 9    723     8 1    8    69  46     "
   " 9   7 6 2  5  1  7     9   7 6  5   5 7 8 9   4  1 8   3     8  9  6  7 1 8   4 "
   "5  3   7       6  2 48 9   72  4  9   5   4   8  1  57   6 87 5  2       3   2  8"
   "8   7     3   56    9    82   6  1 4   213   1 6  7   62    7    89   1     2   5"
   "  4  7  37 9  48 2    8      5       4 172 6       1      6    3 78  2 45  2  9  "
   "  8  46    37    16 58     3 1 2    4       2    5 9 6     97 51    54    73  2  "
   "8  1  7  4   7 6  5    2     49  2 7 1     3 9 7  38     4    3  6 1   4  5  6  2"
   " 1 8 4   8   2   9 5 7    8 2       37  4  82       3 6    1 9 2   9   4   2 3 1 "
   "3  2   4  62  4  1    5 6    7 4     2  7  9     3 8    4 1    6  4  98  5   8  2"
   "51        79  2     46 95     4  8 6 8     3 3 5  7     69 87     2  49        23"
   "  7   4 98   91  5 5        7  5 6    2   3    3 4  5        4 4  78   62 1   7  "
   "46 3   8 3     1      47 3     63 1 5       8 8 42     3 25      8     9 9   8 26"
   "      2 6 1  86 5 8 34      2  631             412  6      58 7 8 24  3 2 9      "
   " 5   41  3    1 6   1  7 93   59  3           4  72   82 7  3   7 8    9  61   5 "
   " 4 8   2   2   6      129 57   5 1  5       9  8 9   79 436      6   8   1   8 3 "
   " 54 2     2     6 9    3 2    2  71    4 1    86  7    4 1    6 7     3     5 98 "
   " 695   1      3       196 8 83 4    5       7    7 82 9 625       4      2   817 "
   "  7 4  6     26 7 53  8    7    5    51   89    4    2    5  13 7 19     8  3 4  "
   "  2   5  1 68    3     9 8     7   4 4 698 7 6   1     2 4     7    32 9  4   3  "
   "  8    6  9 53    6    723  79   3 6         3 2   84  874    9    15 8  1    5  "
   "174    2     3  6 3       7  98      3 649 5      17  2       3 5  1     8    149"
   "      8   7 12 3  249 6        86  5 1     6 5  73        9 271  1 75 4   4      "
   "       2  7      9 8932 4   149       2 8 7       251   8 9714 1      7  3       "
   "9 6    5  7 8   1    94       7 4 3   5 3 7   2 1 9       23    5   8 2  4    9 8"
   "     7   6 5    4  2  83 6 5    23  2       1  97    6 1 62  3  4    9 7   3     "
   " 9         5   9 848 3   1  1  34 9    5 7    5 91  2  6   3 852 9   4         6 "
   "   8  694  935     2  1    64       7 3   4 6       85    6  5     982  274  5   "
   " 9   874   4 6           351    4 9  47   15  5 3    741           8 2   735   6 "
   "3425    9           847  5  93     4   1 2   7     62  5  182           8    6971"
   "8  1    4     72   4   8   2 35 61    6   9    18 35 6   2   6   96     7    9  5"
   " 2    9  3   6      7  32 4   6 7  8 3     4 9  1 8   2 67  8      8   9  4    1 "
   "4      26 7 94     9   1        85 73       45 84        5   1     67 8 72      5"
   "      421        5   183  74    6 1   7 5 9   9 8    21  735   7        963      "
   " 3    7    69    1  9 6  8  9    8  7  528  4  8    3  4  3 1  8    23    1    5 "
   "      65     149  82   5   76 8  2  5       7  3  7 68   9   14  643     42      "
   " 4   8 7 6        2 9 7   8   3 572   1   5   254 1   1   3 8 5        9 6 2   3 "
   "2    8     56 1     3   526 58  6  9         9  1  65 127   9     9 42     8    3"
   "69 1     81 5      3 6  4    3    1 7 6   3 9 4    5    1  9 4      8 35     5 27"
   " 4  21 93   3   5   3  57  7         1 9 6 4         7  85  1   3   9   69 18  2 "
   "8   7  427  8       5   9   142        635        168   3   4       7  626  1   7"
   "     8   52      13 69         39 7   47 69   9 21         53 61      94   8     "
   " 3 26       7 1  8 6    24 71    6      3      3    89 25    9 1  4 2       78 2 "
   "4    85 3   2   647      9  6  3      5 7 6      5  1  1      697   3   6 34    1"
   "    52  3   3   49   98  5 5   2 3    2   8    1 9   5 3  68   17   9   6  23    "
   "12    87   3    9    6 7    71 639             687 23    1 8    4    7   19    45"
   "  85    2        79  26  8   5  3 7 3 7   2 4 9 7  8   3  82  16        2    49  "
   "51 6       394    48   7   2     5     271     6     3   4   89    123       3 16"
   "     3 2  9  8  7   425   98    5 12         26 1    79   146   3  9  5  8 5     "
   "   1    4 7 2  85 4 1 6     39      2  3 6  5      12     2 4 8 18  9 7 5    8   "
   "3    7   2 9  3   5189     1   4 2    2   6    5 7   4     4398   8  5 2   3    1"
   " 75 1        5   69 1   4  1    8 7  63   84  9 3    1  9   5 43   2        7 98 "
   "71   2  5  5   42 8   9     91 7    2       3    5 29     1   2 87   5  9  4   17"
   "8     5   35   1 2   6 1   7 9 86  4         2  94 8 1   8 4   6 8   71   2     9"
   "    93       6 8 78     56    6  2 1 5     8 1 3  8    79     63 1 4       31    "
   "4  7 8    9    1      2  54 2 9   61    6    56   1 9 63  4      4    8    8 5  3"
   "  29 1 8   3    69    4    3 54 2 7           8 6 71 5    6    62    4   3 1 59  "
   "3       9   216 7 17   5     6     289     574     6     5   96 8 473   2       4"
   " 985          9 3   4     2     3127 6     5 7534     4     5   8 3          826 "
   "   3   5 1       7 4  2 19   1 9  26 8     7 62  5 9   96 4  8 3       2 1   3   "
   "2 938    1     9  3  4   2 9  6  4     8 3     8  5  1 1   2  4  3     9    743 2"
   "  9    5 5    163  8 73     18   3 5         3 6   94     27 9  914    8 2    7  "
   " 5     3   7  6 8 4 62        68   92   7   11   24        23 5 3 7  9   9     7 "
   "7 85     5  7  1    2 4     5   6   37     86   1   5     1 6    6  7  2     94 1"
   "  6  5   8   1  744     1 39  5 87             13 4  93 9     527  5   8   8  2  "
   "98 5 2          42   9      96 5   81       75   3 12      5   74          4 1 65"
   "   4     165     9    1   6   3  7 8 8 6 1 9 5 1  2   2   3    7     842     9   "
   " 3   2   2    3  74 6 9      26   5 1 7   6 8 5   14      8 7 47  5    9   4   8 "
   " 8 9    542    7    3  62  7  2      3     6      8  1  48  3    5    423    9 1 "
   " 1   287         263  7     7   84    51 39    19   8     5  987         687   3 "
   "1  92   4 4     82 3 4     6   3 8     5 4     1 8   3     5 2 47     3 5   69  7"
   "  6 9 87   35     9 1     2   84     9  3  1     51   6     5 9     61   42 7 3  "
   "      1 7   91  48    3  2  12     3  56 24  9     87  2  9    59  68   3 7      "
   "    9 3 59    5    3 6 4         15  98 5 24  73         5 3 8    2    96 4 8    "
   "52     7     3  4 1  8 2   94 7        621        4 68   4 8  5 9  6     3     17"
   "     35    4 7 1   2 56   47    68 5         5 98    14   82 9   3 4 6    76     "
   "   89 2 348      6      1   2 5 8     3 1 4     3 4 6   7      3      122 1 67   "
   "6    3   4 5  21     5489  1     7  5       4  8     5  6429     26  8 1   1    2"
   "1 4 729   5 46  3           28      9   1   6      25           4  21 6   754 3 2"
   "9    7          628 36  74  7   9    1 7 5 3    8   5  95  68 326          9    4"
   " 94  8   32    5    8 7     6 4    8 8  5  3 4    2 7     2 3    3    52   9  14 "
   " 2  7    1   85  959      223          5 3          564      618  42   7    6  8 "
   " 5 84  12  72     1 83            7 6 3   5 8 1            86 7     21  24  73 5 "
   "    15   6 7 9  4   9  6  7 2     3 8   6   4 3     8 4  8  5   1  7 4 2   64    "
   "9  1     6      25 5 48  1  6  7 3     2 1     7 6  8  2  94 3 79      2     2  6"
   "94     2   7 4  5     7 4 1 9 6 23             28 3 9 4 9 2     1  3 5   6     47"
   "5 37     89 5   16             4  7  65   93  2  7             23   6 87     46 1"
   "     8 9  98     2    3  58 2   7     14869     2   6 57  6    9     47  4 1     "
   " 25         2   31  974      3  1 588       215 8  6      675  74   9         37 "
   "31 9          47  4 6     8   54 8  7   3   2  1 67   2     6 9  84          6 57"
   "9  2    8 3 5 4 1  4 3    22 8         8 5         7 54    1 9  8 4 2 3 1    3  4"
   "    4  21   8  5  7  5    8  9  2 8 32     76 1 6  9  4    9  7  3  1   17  3    "
   "1  3   6 4  5  9  8   9   2  74   1 2       8 6   24  5   7   6  2  5  4 8   9  3"
   " 3    52  1  8   97 2 6    6  4 8 7           7 3 6  8    5 1 25   2  9  27    6 "
   "18        4  52     9   3 6 5 8    1   715   8    4 5 7 6   1     32  9        63"
   " 9   67  1     8 9 6 72  5   8  2      1 5      6  4   4  68 7 9 5     4  64   8 "
   "    87  2  49 1   37      8 8    1 9    2    4 5    2 5      67   7 39  7  41    "
   "   7   287  2       8 51    5  8  7   95 73   6  2  8    91 4       5  691   2   "
   "    2 4   4   69  23  1     6 3   5   9 8 2   7   2 4     5  72  18   9   5 6    "
   "3    62    7    1  4  2 7    3    2 5  163  4 8    3    8 9  3  2    5    98    7"
   "     2743    3      48 1 6       1 7  14 73  8 2       4 1 38      6    3597     "
   " 1   5    5436  8 6  7    3      2   3 5 4 9   2      1    7  2 9  8315    1   7 "
   "  4  8     53  1      7  5997  4  3    6 7    3  8  6428  1      9  68     8  9  "
   "89  1      2  8   5    2 7   5  6  3  67 31  3  9  6   5 1    2   5  8      3  94"
   "   1 2       7  6 9  6  81  5   7  3 78   64 4  8   9  23  1  8 8  2       5 8   "
   " 3   12   27 5   4    26   1       8  2 6 1  8       7   34    2   9 65   56   9 "
   "  965           72 1   9  52 3  8      9 3      5  7 98  7   9 45           451  "
   "5  1  9      3  7   7  9   9  2  7 63   9   86 5  1  9   9  3   1  7      8  6  5"
   "  5 3     24    1  3   7     9 43  6   1 5   6  87 3     3   8  1    59     2 4  "
   "7  8    4    3 91 2   6 8        3291       7329        1 9   2 86 4    4    1  8"
   " 8  6    3  1   7 65 7   3     3 9 4   8 9   2 1 4     1   2 85 4   5  7    8  4 "
   "4 2 7    16   5 3       76  3   6  1  5   4  9  4   2  78       4 1   79    6 3 2"
   " 4 8  2   59     61    3  5  65      1     3      47  9  4    12     59   1  8 7 "
   "5   6    3 8    64 76  4   2     3     395     1     8   6  94 89    7 6    5   3"
   "   95      4  8  15    17 9  8  2    19   65    3  8  4 62    32  1  9      74   "
   "      9 829     6    87 3  1    54     264     41    6  5 47    3     896 1      "
   "  478    81   9   32 5     6     3     692     5     4     4 25   8   17    264  "
   "  46  879   9      9  1   2 6 1     5   3   7     9 2 8   9  6      3   136  84  "
   "    5 2 4  7 8 3  5  1   767    8     9   6     9    381   5  7  2 4 8  9 4 2    "
   "  4 162  8     1 9 3 4             47  3 9  82             3 9 3 7     5  956 4  "
   "  4  5 98  9 71  3       6    3  2  53     14  2  9    1       4  52 3  72 8  5  "
   "9   14    45  8   7 15         6 5   56   87   3 4         73 9   9  24    32   8"
   " 3 7   1    3625  7         6 8 79 4         5 74 3 2         1  6278    9   5 4 "
   "   34 6  7 4  2    25  9    9   7  3  1   7  8  1   6    9  41    7  5 8  3 54   "
   "659      8   19      5  3   6   35     495     78   9   8  2      34   8      134"
   " 27   8 643  6       1  3  96 4         8         9 57  2  8       5  626 3   57 "
   "47      8 9   5   1 32         5 1  5  719  4  8 6         82 1   6   5 7      96"
   "32  7       8   63 14 9    96   1   5       8   3   26    3 98 17   8       6  57"
   " 7           9 852 2  867  6  84      2   3      13  6  825  4 597 3           1 "
   "   6 8    9   28 3  5   2  5  3    47 9   1 81    5  6  4   6  9 67   4    1 6   "
   "  28  5  86    9     12       6 32   4  1  5   19 4       96     5    76  3  84  "
   "7   14       7 94   9   8  4 725     2     1     432 5  6   5   82 3       68   9"
   "2  14 8  93           5 4 7  5  8  1 9     4 1  3  7  5 6 3           76  3 26  8"
   "6  3   1 3     2      65 8 79   1     4 7 9     8   67 5 41      6     9 3   2  1"
   "58    7 62   6  3    8   94   38      1   4      92   19   8    2  1   53 4    87"
   "  96  7      1 2 8     8 63  8   9 7 4     3 6 2   8  82 1     9 6 3      3  54  "
   "62  9         218  5 16     1    3 2  2   9  7 5    6     23 7  765         1  94"
   "    4 6   849  7     3  9      17  4 1     2 6  28      5  1     1  537   8 9    "
   "4 9 6       4  7 6 3 1 9     7  4 6   5   9   4 9  1     3 2 8 3 1  8       5 3 2"
   " 567          256   4  5    3 4 9 8 4       9 2 1 6 3    2  8   893          147 "
   " 6 748   24  1   8       7  24  38             86  19  5       3   5  87   391 5 "
   "   7  94 64   37  7   9     6   4    25   19    5   3     8   5  13   28 56  1   "
   " 9    1    1     42 41   6 983  7      4 3      6  395 6   87 31     5    9    2 "
   " 8    4 1       3  64 79 5 7 38 4               7 53 6 3 69 51  9       1 8    9 "
   "7      9     587  5 67  4      679  2       4  451      3  41 6  712     4      3"])

(deftest test-solve
  (is (every? :solved (for [puzzle-str test-puzzles]
                        (let [puzzle (read/string->puzzle puzzle-str)]
                          (solve/solve-with-containment-finder solve/find-containment puzzle))))))
